<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Cheng Man Yu (Jeff) ‚Äì AI & Software Enthusiast</title>
    <link rel="stylesheet" href="styles.css">
    <!-- Ê∑ªÂä† Font Awesome ÂúñÊ®ôÂ∫´ -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <!-- Ê∑ªÂä† Particles.js -->
    <script src="https://cdn.jsdelivr.net/npm/particles.js@2.0.0/particles.min.js"></script>

    <style>
/* ========== ËÅäÂ§©Ê©üÂô®‰∫∫Ë®≠Ë®à - ÂåπÈÖçÈ†ÅÈù¢È¢®Ê†º ========== */

/* ÊµÆÂãïËÅäÂ§©Ê©üÂô®‰∫∫ÁêÉÈ´î */
.chatbot-ball {
    position: fixed;
    bottom: 30px;
    right: 30px;
    width: 60px;
    height: 60px;
    background: linear-gradient(135deg, #3498db, #2ecc71);
    border-radius: 50%;
    cursor: pointer;
    box-shadow: 0 8px 25px rgba(52, 152, 219, 0.6);
    display: flex;
    align-items: center;
    justify-content: center;
    animation: float 3s ease-in-out infinite;
    z-index: 999;
    transition: all 0.3s ease;
    border: 3px solid rgba(255, 255, 255, 0.2);
    overflow: hidden;
}

.chatbot-ball:hover {
    transform: scale(1.15);
    box-shadow: 0 12px 35px rgba(52, 152, 219, 0.8);
}

.chatbot-avatar {
    width: 70%;
    height: 70%;
    object-fit: cover;
    border-radius: 50%;
    position: absolute;
    top: 50%;
    left: 50%;
    transform: translate(-50%, -50%);
}

.chatbot-pulse {
    position: absolute;
    width: 100%;
    height: 100%;
    border-radius: 50%;
    border: 2px solid #2ecc71;
    animation: pulse-animation 2s ease-in-out infinite;
}

@keyframes pulse-animation {
    0%, 100% { transform: scale(1); opacity: 1; }
    50% { transform: scale(1.15); opacity: 0; }
}

@keyframes float {
    0%, 100% { transform: translateY(0px); }
    50% { transform: translateY(-15px); }
}

/* ËÅäÂ§©Á™óÂè£ */
.chatbot-window {
    position: fixed;
    bottom: 110px;
    right: 30px;
    width: 350px;
    height: 500px;
    background: linear-gradient(135deg, rgba(10, 14, 39, 0.95), rgba(26, 30, 62, 0.95));
    border: 2px solid rgba(52, 152, 219, 0.4);
    border-radius: 20px;
    box-shadow: 0 15px 50px rgba(0, 0, 0, 0.6);
    display: none;
    flex-direction: column;
    z-index: 998;
    backdrop-filter: blur(10px);
    animation: slideUp 0.4s ease-out;
}

.chatbot-window.active {
    display: flex;
}

@keyframes slideUp {
    from { opacity: 0; transform: translateY(30px); }
    to { opacity: 1; transform: translateY(0); }
}

/* ËÅäÂ§©È†≠ÈÉ® */
.chatbot-header {
    background: linear-gradient(135deg, #3498db 0%, #2980b9 100%);
    color: white;
    padding: 1rem 1.2rem;
    border-radius: 18px 18px 0 0;
    display: flex;
    justify-content: space-between;
    align-items: center;
    box-shadow: 0 4px 15px rgba(52, 152, 219, 0.3);
    user-select: none;
    cursor: grab;
}

.chatbot-header:active {
    cursor: grabbing;
}

.chatbot-header-content {
    display: flex;
    align-items: center;
    gap: 1rem;
}

.chatbot-header-avatar {
    width: 45px;
    height: 45px;
    border-radius: 50%;
    border: 2px solid rgba(255, 255, 255, 0.3);
    object-fit: cover;
}

.chatbot-header-text h3 {
    margin: 0;
    font-size: 1.1rem;
}

.chatbot-status {
    margin: 0;
    font-size: 0.75rem;
    color: rgba(255, 255, 255, 0.8);
    display: flex;
    align-items: center;
    gap: 0.4rem;
}

.chatbot-status::before {
    content: '';
    width: 8px;
    height: 8px;
    background: #2ecc71;
    border-radius: 50%;
    animation: online-pulse 2s infinite;
}

@keyframes online-pulse {
    0%, 100% { opacity: 1; }
    50% { opacity: 0.5; }
}

.chatbot-header-controls {
    display: flex;
    align-items: center;
    gap: 0.5rem;
}

.voice-toggle-btn {
    background: rgba(255, 255, 255, 0.2);
    border: none;
    color: white;
    font-size: 1.1rem;
    cursor: pointer;
    padding: 0.5rem;
    width: 36px;
    height: 36px;
    border-radius: 50%;
    transition: all 0.3s;
}

.voice-toggle-btn:hover {
    background: rgba(255, 255, 255, 0.35);
}

.voice-toggle-btn.active {
    background: #2ecc71;
    box-shadow: 0 0 12px rgba(46, 204, 113, 0.6);
}

.close-btn {
    background: transparent;
    border: none;
    color: white;
    font-size: 1.6rem;
    cursor: pointer;
    padding: 0;
    width: 36px;
    height: 36px;
    display: flex;
    align-items: center;
    justify-content: center;
    border-radius: 50%;
    transition: all 0.3s;
}

.close-btn:hover {
    background: rgba(255, 255, 255, 0.2);
}

/* Ê∂àÊÅØÂçÄÂüü */
.chatbot-messages {
    flex: 1;
    overflow-y: auto;
    padding: 1.2rem;
    display: flex;
    flex-direction: column;
    gap: 1rem;
    background: rgba(10, 14, 39, 0.4);
}

.message {
    display: flex;
    gap: 0.8rem;
    animation: slideIn 0.3s ease;
}

.message.user {
    justify-content: flex-end;
}

.message.bot {
    justify-content: flex-start;
}

.message-bubble {
    max-width: 78%;
    padding: 0.9rem 1.2rem;
    border-radius: 18px;
    font-size: 0.95rem;
    line-height: 1.4;
}

.user .message-bubble {
    background: linear-gradient(135deg, #3498db, #2980b9);
    color: white;
    border-bottom-right-radius: 4px;
}

.bot .message-bubble {
    background: rgba(52, 152, 219, 0.15);
    color: #ecf0f1;
    border: 1px solid rgba(52, 152, 219, 0.3);
    border-bottom-left-radius: 4px;
}

/* Ëº∏ÂÖ•ÂçÄÂüü */
.chatbot-input-area {
    display: flex;
    gap: 0.8rem;
    padding: 1rem 1.2rem;
    border-top: 1px solid rgba(52, 152, 219, 0.2);
    background: rgba(10, 14, 39, 0.9);
    border-radius: 0 0 18px 18px;
}

.chatbot-input {
    flex: 1;
    background: rgba(255, 255, 255, 0.08);
    border: 1px solid rgba(52, 152, 219, 0.3);
    color: white;
    padding: 0.8rem 1.2rem;
    border-radius: 12px;
    font-size: 0.95rem;
}

.chatbot-input:focus {
    outline: none;
    border-color: #3498db;
    box-shadow: 0 0 10px rgba(52, 152, 219, 0.4);
}

.send-btn {
    background: linear-gradient(135deg, #3498db, #2980b9);
    color: white;
    border: none;
    padding: 0.8rem 1.2rem;
    border-radius: 12px;
    cursor: pointer;
    min-width: 48px;
    transition: all 0.3s;
}

.send-btn:hover {
    transform: translateY(-2px);
    box-shadow: 0 6px 15px rgba(52, 152, 219, 0.5);
}

.send-btn:disabled {
    opacity: 0.5;
    cursor: not-allowed;
}

/* Âä†ËºâÂãïÁï´ */
.loading {
    display: flex;
    gap: 0.5rem;
    padding: 0.8rem 1.2rem;
    background: rgba(52, 152, 219, 0.1);
    border-radius: 18px;
    width: fit-content;
}

.loading-dot {
    width: 8px;
    height: 8px;
    background: #3498db;
    border-radius: 50%;
    animation: bounce 1.4s infinite;
}

.loading-dot:nth-child(2) { animation-delay: 0.2s; }
.loading-dot:nth-child(3) { animation-delay: 0.4s; }

@keyframes bounce {
    0%, 80%, 100% { transform: translateY(0); opacity: 0.5; }
    40% { transform: translateY(-10px); opacity: 1; }
}

/* ÈüøÊáâÂºè */
@media (max-width: 480px) {
    .chatbot-window {
        width: calc(100vw - 20px);
        height: 70vh;
        bottom: 90px;
        right: 10px;
        left: 10px;
        border-radius: 16px;
    }
    .chatbot-ball {
        width: 55px;
        height: 55px;
        bottom: 20px;
        right: 20px;
    }
}

    </style>
</head>
<body>
    <!-- Á≤íÂ≠êËÉåÊôØ -->
    <div id="particles-js"></div>

    <!-- Â∞éËà™Ê¨Ñ -->
    <nav class="navbar">
        <div class="container">
            <div class="nav-brand">Cheng Man Yu (Jeff)</div>
            <div class="nav-links">
                <a href="#home">Home</a>
                <a href="#about">About</a>
                <a href="#projects">Projects</a>
                <a href="cv.html">CV</a>
            </div>
        </div>
    </nav>

    <!-- Hero ÂçÄÂüü -->
    <section id="home" class="hero">
        <div class="container">
            <div class="hero-content fade-in">
                <h1 class="glitch">Hi, I'm Jeff Cheng</h1>
                <p class="subtitle">Aspiring AI Engineer & Software Developer</p>
                <p class="description">Currently pursuing BSc in Computer Science - AI Concentration at Hong Kong Baptist University</p>
                
                <!-- Á§æ‰∫§ÂúñÊ®ô -->
                <div class="social-icons">
                    <a href="tel:+85255475715" class="social-icon" title="Phone">
                        <i class="fas fa-phone"></i>
                    </a>
                    <a href="mailto:wenyu55475715@gmail.com" class="social-icon" title="Gmail">
                        <i class="fas fa-envelope"></i>
                    </a>
                    <a href="mailto:25206591@life.hkbu.edu.hk" class="social-icon" title="HKBU Email">
                        <i class="fas fa-graduation-cap"></i>
                    </a>
                    <a href="https://linkedin.com/in/man-yu-cheng-780632279" target="_blank" class="social-icon" title="LinkedIn">
                        <i class="fab fa-linkedin"></i>
                    </a>
                    <a href="https://github.com/chengmanyu" target="_blank" class="social-icon" title="GitHub">
                        <i class="fab fa-github"></i>
                    </a>
                </div>

                <div class="cta-buttons">
                    <a href="#projects" class="btn btn-primary">
                        <i class="fas fa-rocket"></i> View Projects
                    </a>
                    <a href="https://chengmanyu-ppt-ai-outline.hf.space/" target="_blank" class="btn btn-secondary">
                        <i class="fas fa-magic"></i> Try AI Demo
                    </a>
                </div>
            </div>
        </div>
    </section>

    <!-- ÈóúÊñºÊàë -->
    <section id="about" class="about">
        <div class="container">
            <h2 class="section-title fade-in-up">About Me</h2>
            <p class="section-subtitle fade-in-up">Passionate about building intelligent applications using LLMs and modern web technologies</p>            
            
            <div class="about-grid">
                <!-- ÊïôËÇ≤ËÉåÊôØ -->
                <div class="about-card fade-in-up">
                    <div class="card-icon">üéì</div>
                    <h3>Education</h3>
                    <ul>
                        <li><strong>Hong Kong Baptist University</strong> (2025-2027)<br>
                            BSc in Computer Science - <span class="highlight">AI Concentration</span></li>
                        <li><strong>Hong Kong Institute of Vocational Education (Tuen Mun)</strong> (2023-2025)<br>
                            Higher Diploma in AI & Mobile Applications Development<br>
                            <span class="badge">5 Scholarships</span></li>
                    </ul>
                </div>

                <!-- Â∑•‰ΩúÁ∂ìÈ©ó -->
                <div class="about-card fade-in-up">
                    <div class="card-icon">üíº</div>
                    <h3>Work Experience</h3>
                    <p><strong>iN and iN Management Limited</strong><br>
                    <em>Assistant AI Training Specialist (Jul-Aug 2024)</em></p>
                    <ul>
                        <li>Developed AI Customer Service Chatbot (Python)</li>
                        <li>Designed UI for 60+ AI Mobile Puzzle Games (Unity)</li>
                        <li>Built File System Server: Hardware & Functions</li>
                        <li>Assisted with AI dataset collection</li>
                    </ul>
                </div>

                <!-- Ë™ûË®ÄËÉΩÂäõ -->
                <div class="about-card fade-in-up">
                    <div class="card-icon">üåê</div>
                    <h3>Languages</h3>
                    <ul>
                        <li><strong>Cantonese</strong> - Native Speaker</li>
                        <li><strong>Mandarin</strong> - Fluent</li>
                        <li><strong>English</strong> - Medium of communication</li>
                    </ul>
                    <h3 style="margin-top: 1.5rem;">Certifications</h3>
                    <ul>
                        <li>Standard First Aid Certificate</li>
                        <li>NVIDIA AI for Science Bootcamp (2023)</li>
                    </ul>
                </div>
            </div>

            <!-- ÊäÄËÉΩÊ®ôÁ±§ -->
            <div class="skills-section fade-in-up" style="margin-top: 3rem;">
                <h3 class="section-title" style="font-size: 2rem;">Technical Skills</h3>
                <div class="skills-tags">
                    <span class="skill-tag"><i class="fab fa-python"></i> Python</span>
                    <span class="skill-tag"><i class="fab fa-java"></i> Java</span>
                    <span class="skill-tag"><i class="fab fa-html5"></i> HTML/CSS/JS</span>
                    <span class="skill-tag"><i class="fas fa-database"></i> SQL</span>
                    <span class="skill-tag"><i class="fab fa-android"></i> Android Studio</span>
                    <span class="skill-tag"><i class="fas fa-brain"></i> AI Frameworks</span>
                    <span class="skill-tag"><i class="fab fa-unity"></i> Unity</span>
                    <span class="skill-tag"><i class="fas fa-robot"></i> LLMs</span>
                </div>
            </div>
        </div>
    </section>

    <!-- È†ÖÁõÆÂ±ïÁ§∫ -->
    <section id="projects" class="projects">
        <div class="container">
            <h2 class="section-title fade-in-up">Featured Projects</h2>
            <p class="section-subtitle fade-in-up">Selected project showcases</p>

            <div class="project-card fade-in-up">
                <div class="project-icon">üìä‚ú®</div>
                <div class="project-content">
                    <h3>PPT Outline AI Generator</h3>
                    <p>AI tool that instantly generates professional 5-slide PowerPoint outlines from any topic</p>
                    
                    <div class="project-highlights">
                        <div class="highlight-item">
                            <i class="fas fa-check-circle"></i>
                            <span>Fine-tuned <strong>Qwen2-1.5B-Instruct</strong> using LoRA on 500 high-quality examples</span>
                        </div>
                        <div class="highlight-item">
                            <i class="fas fa-check-circle"></i>
                            <span>Stable training (3 epochs) with decreasing validation loss</span>
                        </div>
                        <div class="highlight-item">
                            <i class="fas fa-check-circle"></i>
                            <span>Deployed permanently on <strong>Hugging Face Spaces</strong></span>
                        </div>
                        <div class="highlight-item">
                            <i class="fas fa-check-circle"></i>
                            <span>Supports English and Chinese prompts</span>
                        </div>
                    </div>

                    <div class="project-buttons">
                        <a href="projects/ppt-outline.html" class="btn btn-primary">
                            <i class="fas fa-info-circle"></i> View Details
                        </a>
                        <a href="https://chengmanyu-ppt-ai-outline.hf.space/" target="_blank" class="btn btn-secondary">
                            <i class="fas fa-play"></i> Try Live Demo
                        </a>
                    </div>
                </div>
            </div>
        </div>
    </section>

    <!-- È†ÅËÖ≥ -->
    <footer class="footer">
        <div class="container">
            <div class="footer-content">
                <div class="footer-section">
                    <h4>Contact Information</h4>
                    <p><i class="fas fa-phone"></i> +852 55475715</p>
                    <p><i class="fas fa-envelope"></i> <strong>wenyu55475715@gmail.com</strong></p>
                    <p><i class="fas fa-envelope"></i> <strong>25206591@life.hkbu.edu.hk</strong></p>
                </div>
                <div class="footer-section">
                    <h4>Quick Links</h4>
                    <a href="#home">Home</a>
                    <a href="#about">About</a>
                    <a href="#projects">Projects</a>
                    <a href="cv.html">CV</a>
                </div>
                <div class="footer-section">
                    <h4>Connect With Me</h4>
                    <a href="https://linkedin.com/in/man-yu-cheng-780632279" target="_blank">
                        <i class="fab fa-linkedin"></i> LinkedIn
                    </a>
                    <a href="https://github.com/chengmanyu" target="_blank">
                        <i class="fab fa-github"></i> GitHub
                    </a>
                    <a href="https://chengmanyu-ppt-ai-outline.hf.space/" target="_blank">
                        <i class="fas fa-rocket"></i> AI Demo
                    </a>
                </div>
            </div>
            <div class="footer-bottom">
                <p>&copy; 2026 Cheng Man Yu (Jeff). All rights reserved.</p>
            </div>
        </div>
    </footer>

   <script src="script.js"></script>

<!-- ÊµÆÂãïËÅäÂ§©Ê©üÂô®‰∫∫ÁêÉÈ´î -->
<div class="chatbot-ball" id="chatbotBall">
    <img src="assets/images/anime_icon2.jpg" alt="Jeff's AI Assistant" class="chatbot-avatar">
    <div class="chatbot-pulse"></div>
</div>

<!-- ËÅäÂ§©Á™óÂè£ÔºàÂè™‰øùÁïôÈÄô‰∏ÄÂÄãÂÆåÊï¥ÁµêÊßãÔºâ -->
<div class="chatbot-window" id="chatbotWindow">
    <div class="chatbot-header">
        <div class="chatbot-header-content">
            <img src="assets/images/anime_icon2.jpg" alt="Jeff" class="chatbot-header-avatar">
            <div class="chatbot-header-text">
                <h3>Jeff's AI Assistant</h3>
                <p class="chatbot-status">Online</p>
            </div>
        </div>
        <div class="chatbot-header-controls">
            <button class="voice-toggle-btn" id="voiceToggleBtn" title="Enable/Disable voice">
                <i class="fas fa-volume-mute"></i>
            </button>
            <button class="close-btn" id="closeBtn">√ó</button>
        </div>
    </div>
    
    <div class="chatbot-messages" id="chatMessages"></div>
    
    <div class="chatbot-input-area">
        <input 
            type="text" 
            id="userInput" 
            placeholder="Ask me about Jeff..." 
            class="chatbot-input"
        />
        <button class="send-btn" id="sendBtn">
            <i class="fas fa-paper-plane"></i>
        </button>
    </div>
</div>

    
    <script>
// ==================== ËÅäÂ§©Ê©üÂô®‰∫∫ÈÖçÁΩÆ ====================
const DEEPSEEK_API_KEY = 'sk-e21a1283d3804330a9a06a1134fccf80';
const DEEPSEEK_API_URL = 'https://api.deepseek.com/chat/completions';

// Jeff ÁöÑÂÄã‰∫∫‰ø°ÊÅØ
const JEFF_INFO = {
    name: 'Cheng Man Yu (Jeff)',
    title: 'Aspiring AI Engineer & Software Developer',
    skills: ['Python', 'Java', 'JavaScript', 'HTML/CSS', 'Android Studio', 'AI Frameworks', 'Unity', 'LLMs'],
    experience: '1+ years of professional experience as AI Training Specialist',
    education: 'BSc in Computer Science - AI Concentration (HKBU, 2025-2027) | Higher Diploma in AI & Mobile Applications Development (IVE Tuen Mun, 2023-2025)',
    projects: [
        'PPT Outline AI Generator - Fine-tuned Qwen2-1.5B using LoRA',
        'AI Customer Service Chatbot - Python',
        'UI Design for 60+ AI Mobile Puzzle Games - Unity',
        'Portfolio Website with AI Assistant - Vanilla JS'
    ],
    email: '25206591@life.hkbu.edu.hk',
    personalEmail: 'wenyu55475715@gmail.com',
    phone: '+852 55475715',
    github: 'https://github.com/chengmanyu',
    linkedin: 'https://linkedin.com/in/man-yu-cheng-780632279',
    location: 'Hong Kong',
    bio: 'Passionate about building intelligent applications using LLMs and modern web technologies. Recipient of 5 scholarships during higher diploma studies.'
};

const SYSTEM_PROMPT = `‰Ω†ÊòØ ${JEFF_INFO.name} ÁöÑ AI Âä©Êâã„ÄÇ‰Ω†ÁöÑËßíËâ≤ÊòØ‰ª£Ë°® Jeff ÂõûÁ≠îÈóúÊñº‰ªñÁöÑÂïèÈ°å„ÄÇ

ÈóúÊñº Jeff ÁöÑË©≥Á¥∞‰ø°ÊÅØÔºö
- ÂßìÂêçÔºö${JEFF_INFO.name}
- ËÅ∑‰ΩçÔºö${JEFF_INFO.title}
- ÊäÄËÉΩÔºö${JEFF_INFO.skills.join(', ')}
- Â∑•‰ΩúÁ∂ìÈ©óÔºö${JEFF_INFO.experience}
- ÊïôËÇ≤ËÉåÊôØÔºö${JEFF_INFO.education}
- ‰∏ªË¶ÅÈ†ÖÁõÆÔºö${JEFF_INFO.projects.join(' | ')}
- ÈÉµÁÆ±Ôºö${JEFF_INFO.email} Êàñ ${JEFF_INFO.personalEmail}
- ÈõªË©±Ôºö${JEFF_INFO.phone}
- GitHubÔºö${JEFF_INFO.github}
- LinkedInÔºö${JEFF_INFO.linkedin}
- ‰ΩçÁΩÆÔºö${JEFF_INFO.location}
- ÂÄã‰∫∫Á∞°‰ªãÔºö${JEFF_INFO.bio}

Ë´ãÁî®ÂèãÂñÑ„ÄÅÂ∞àÊ•≠ÁöÑË™ûÊ∞£ÔºåÁπÅÈ´î‰∏≠ÊñáÂõûÁ≠îÁî®Êà∂ÁöÑÂïèÈ°å„ÄÇÁî®Êà∂ÂèØËÉΩÁî®‰∏≠ÊñáÊàñËã±ÊñáÊèêÂïèÔºåË´ãÁî®Áõ∏ÂêåÁöÑË™ûË®ÄÂõûÁ≠î„ÄÇ
Â¶ÇÊûúÁî®Êà∂ÂïèÁöÑÊòØËàá Jeff ÁÑ°ÈóúÁöÑÂïèÈ°åÔºåÂèØ‰ª•Á¶ÆË≤åÂú∞Â∞áÂ∞çË©±ÂºïÂ∞éÂõû Jeff Áõ∏ÈóúÁöÑË©±È°å„ÄÇ`;

// ==================== ËÅäÂ§©Ë®òÈåÑÁÆ°ÁêÜ ====================
class ChatHistory {
    constructor(maxMessages = 20) {
        this.messages = [];
        this.maxMessages = maxMessages;
    }
    addMessage(role, content) {
        this.messages.push({ role, content });
        if (this.messages.length > this.maxMessages) {
            this.messages = this.messages.slice(-this.maxMessages);
        }
    }
    getMessages() {
        return this.messages;
    }
}

// ==================== Ë™ûÈü≥ÁÆ°ÁêÜÂô® ====================
class SpeechManager {
    constructor() {
        this.isVoiceEnabled = false;
        this.isSpeaking = false;
        this.synth = window.speechSynthesis;
    }

    speak(text, language = 'en-US') {
        if (this.isSpeaking) this.synth.cancel();
        const utterance = new SpeechSynthesisUtterance(text);
        utterance.lang = language;
        utterance.rate = 1;
        utterance.pitch = 1;
        utterance.volume = 1;

        utterance.onstart = () => { this.isSpeaking = true; };
        utterance.onend = () => { this.isSpeaking = false; };
        this.synth.speak(utterance);
    }

    stopSpeaking() {
        this.synth.cancel();
        this.isSpeaking = false;
    }

    toggleVoice() {
        this.isVoiceEnabled = !this.isVoiceEnabled;
        const btn = document.getElementById('voiceToggleBtn');
        if (this.isVoiceEnabled) {
            btn.classList.add('active');
            btn.innerHTML = '<i class="fas fa-volume-up"></i>';
        } else {
            btn.classList.remove('active');
            btn.innerHTML = '<i class="fas fa-volume-mute"></i>';
            this.stopSpeaking();
        }
    }
}

const speechManager = new SpeechManager();

// ==================== ËÅäÂ§©Ê©üÂô®‰∫∫È°û ====================
class ChatBot {
    constructor() {
        this.chatHistory = new ChatHistory();
        this.isLoading = false;
        this.init();
    }

    init() {
        this.ball = document.getElementById('chatbotBall');
        this.window = document.getElementById('chatbotWindow');
        this.messages = document.getElementById('chatMessages');
        this.input = document.getElementById('userInput');
        this.sendBtn = document.getElementById('sendBtn');
        this.closeBtn = document.getElementById('closeBtn');
        this.voiceBtn = document.getElementById('voiceToggleBtn');

        this.ball.addEventListener('click', () => this.toggle());
        this.closeBtn.addEventListener('click', () => this.close());
        this.sendBtn.addEventListener('click', () => this.send());
        this.voiceBtn.addEventListener('click', () => speechManager.toggleVoice());
        this.input.addEventListener('keypress', e => {
            if (e.key === 'Enter' && !this.isLoading) this.send();
        });

        // Âè≥ÈçµÈö±ËóèÁêÉÈ´î
        this.ball.addEventListener('contextmenu', e => {
            e.preventDefault();
            this.ball.style.display = 'none';
            localStorage.setItem('hideChatbotBall', 'true');
            this.close();
        });

        // Ê™¢Êü•ÊòØÂê¶Èö±Ëóè
        if (localStorage.getItem('hideChatbotBall') === 'true') {
            this.ball.style.display = 'none';
        }
    }

    toggle() {
        this.window.classList.toggle('active');
        if (this.window.classList.contains('active')) {
            this.input.focus();
            if (this.messages.children.length === 0) {
                this.addBotMessage('‰Ω†Â•ΩÔºÅÊàëÊòØ Jeff ÁöÑ AI Âä©Êâã„ÄÇÊúâ‰ªÄÈ∫ºÂèØ‰ª•Âπ´‰Ω†ÁöÑÔºü');
            }
        }
    }

    close() {
        this.window.classList.remove('active');
        speechManager.stopSpeaking();
    }

    addMessage(className, content) {
        const div = document.createElement('div');
        div.className = `message ${className}`;
        div.innerHTML = `<div class="message-bubble">${content}</div>`;
        this.messages.appendChild(div);
        this.messages.scrollTop = this.messages.scrollHeight;
    }

    addUserMessage(text) {
        this.addMessage('user', this.escapeHtml(text));
    }

addBotMessage(text) {
    this.addMessage('bot', this.formatText(text));
    if (speechManager.isVoiceEnabled) {
        const lang = /[\u4e00-\u9fa5]/.test(text) ? 'zh-TW' : 'en-US';
        const cleanText = removeEmojis(text);
        if (cleanText.trim()) {
            speechManager.speak(cleanText, lang);
        }
    }
}

    addLoading() {
        const div = document.createElement('div');
        div.className = 'message bot';
        div.id = 'loading';
        div.innerHTML = '<div class="loading"><div class="loading-dot"></div><div class="loading-dot"></div><div class="loading-dot"></div></div>';
        this.messages.appendChild(div);
        this.messages.scrollTop = this.messages.scrollHeight;
    }

    removeLoading() {
        document.getElementById('loading')?.remove();
    }

    escapeHtml(text) {
        return text.replace(/[&<>"']/g, m => ({ '&':'&amp;','<':'&lt;','>':'&gt;','"':'&quot;','\'':'&#039;' }[m]));
    }

    formatText(text) {
        return text
            .replace(/\*\*(.*?)\*\*/g, '<strong>$1</strong>')
            .replace(/\*(.*?)\*/g, '<em>$1</em>')
            .replace(/\n/g, '<br>');
    }

    // ÁßªÈô§ÊâÄÊúâ emojiÔºåÂè™‰øùÁïôÊñáÂ≠óÁµ¶Ë™ûÈü≥
function removeEmojis(text) {
    return text.replace(/[\u{1F300}-\u{1F9FF}\u{2600}-\u{26FF}\u{2700}-\u{27BF}]+/gu, '');
}

    async send() {
        const text = this.input.value.trim();
        if (!text || this.isLoading) return;

        this.input.value = '';
        this.addUserMessage(text);
        this.chatHistory.addMessage('user', text);

        this.isLoading = true;
        this.sendBtn.disabled = true;
        this.addLoading();

        try {
            const reply = await this.getReply(text);
            this.removeLoading();
            this.addBotMessage(reply);
            this.chatHistory.addMessage('assistant', reply);
        } catch (err) {
            this.removeLoading();
            this.addBotMessage('Êä±Ê≠âÔºåÂá∫‰∫ÜÈªûÂïèÈ°å... Ë´ãÁ®çÂæåÂÜçË©¶');
            console.error(err);
        } finally {
            this.isLoading = false;
            this.sendBtn.disabled = false;
            this.input.focus();
        }
    }

    async getReply(userMessage) {
        const messages = [
            { role: 'system', content: SYSTEM_PROMPT },
            ...this.chatHistory.getMessages()
        ];

        const res = await fetch(DEEPSEEK_API_URL, {
            method: 'POST',
            headers: {
                'Content-Type': 'application/json',
                'Authorization': `Bearer ${DEEPSEEK_API_KEY}`
            },
            body: JSON.stringify({
                model: 'deepseek-chat',
                messages,
                temperature: 0.7,
                max_tokens: 1000,
                stream: false
            })
        });

        if (!res.ok) throw new Error('API request failed');
        const data = await res.json();
        return data.choices[0].message.content;
    }
}

// ÂàùÂßãÂåñ
document.addEventListener('DOMContentLoaded', () => {
    new ChatBot();
    console.log('Chatbot initialized');
});

    </script>
</body>
</html>
